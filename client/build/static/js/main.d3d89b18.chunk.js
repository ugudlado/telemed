(window.webpackJsonpclient=window.webpackJsonpclient||[]).push([[0],{198:function(e,t,a){"use strict";a.r(t);var o=a(1),n=a.n(o),i=a(70),c=a.n(i),r=(a(83),a(84),a(71)),l=a(72),s=a(76),d=a(73),m=a(7),h=a(77),u=a(74),v=a.n(u),f=a(75),k=a.n(f),p=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(s.a)(this,Object(d.a)(t).call(this,e))).localMediaRef=Object(o.createRef)(),a.remoteMediaRef=Object(o.createRef)(),a.state={identity:"",roomName:"",roomNameErr:!1,token:"",localMediaAvailable:!1,hasJoinedRoom:!1},a.joinRoom=a.joinRoom.bind(Object(m.a)(a)),a.handleRoomNameChange=a.handleRoomNameChange.bind(Object(m.a)(a)),a.roomJoined=a.roomJoined.bind(Object(m.a)(a)),a.leaveRoom=a.leaveRoom.bind(Object(m.a)(a)),a.detachTracks=a.detachTracks.bind(Object(m.a)(a)),a.detachParticipantTracks=a.detachParticipantTracks.bind(Object(m.a)(a)),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleRoomNameChange",value:function(e){var t=e.target.value;this.setState({roomName:t})}},{key:"joinRoom",value:function(){if(this.state.roomName.trim()){console.log("Joining room '"+this.state.roomName+"'...");var e={name:this.state.roomName};this.state.previewTracks&&(e.tracks=this.state.previewTracks),v.a.connect(this.state.token,e).then(this.roomJoined,function(e){alert("Could not connect to Twilio: "+e.message)})}else this.setState({roomNameErr:!0})}},{key:"attachTrack",value:function(e,t){var a=e;t.appendChild(a.track.attach())}},{key:"detachTrack",value:function(e){e.track.detach().forEach(function(e){e.remove()})}},{key:"attachParticipantTracks",value:function(e,t){var a=this;e.tracks.forEach(function(e){return a.attachTrack(e,t.current)})}},{key:"detachTracks",value:function(e){var t=this;e.forEach(function(e){t.detachTrack(e)})}},{key:"detachParticipantTracks",value:function(e){var t=Array.from(e.tracks.values());this.detachTracks(t)}},{key:"roomJoined",value:function(e){var t=this;console.log("Joined as '"+this.state.identity+"'"),this.setState({activeRoom:e,localMediaAvailable:!0,hasJoinedRoom:!0}),this.localMediaRef.current.querySelector("video")||this.attachParticipantTracks(e.localParticipant,this.localMediaRef),e.participants.forEach(function(e){console.log("Already in Room: '"+e.identity+"'");var a=t.remoteMediaRef;t.attachParticipantTracks(e,a)}),e.on("participantConnected",function(e){console.log("Joining: '"+e.identity+"'")}),e.on("trackAdded",function(e,a){console.log(a.identity+" added track: "+e.kind);var o=t.remoteMediaRef.current;t.attachTrack(e,o)}),e.on("trackRemoved",function(e,a){console.log(a.identity+" removed track: "+e.kind),t.detachTracks([e])}),e.on("participantDisconnected",function(e){console.log("Participant '"+e.identity+"' left the room"),t.detachParticipantTracks(e)}),e.on("disconnected",function(){t.state.previewTracks&&t.state.previewTracks.forEach(function(e){e.stop()}),t.detachParticipantTracks(e.localParticipant),e.participants.forEach(t.detachParticipantTracks),t.setState({hasJoinedRoom:!1,localMediaAvailable:!1,activeRoom:void 0})})}},{key:"componentDidMount",value:function(){var e=this;k.a.get("http://localhost:3001/token").then(function(t){var a=t.data,o=a.identity,n=a.token;e.setState({identity:o,token:n})})}},{key:"leaveRoom",value:function(){this.state.activeRoom.disconnect(),this.setState({hasJoinedRoom:!1,localMediaAvailable:!1})}},{key:"render",value:function(){var e=this.state.localMediaAvailable?n.a.createElement("div",{className:"flex-item"},n.a.createElement("div",{ref:this.localMediaRef})):"",t=this.state.hasJoinedRoom?n.a.createElement("input",{type:"button",value:"Leave Room",onClick:this.leaveRoom}):n.a.createElement("input",{type:"button",value:"Join Room",onClick:this.joinRoom});return n.a.createElement("div",{className:"flex-container"},e,n.a.createElement("div",{className:"flex-item"},n.a.createElement("input",{type:"text",placeholder:"room name",onChange:this.handleRoomNameChange}),n.a.createElement("br",null),t),n.a.createElement("div",{className:"flex-item",ref:this.remoteMediaRef,id:"remote-media"}))}}]),t}(o.Component),R=function(){return n.a.createElement("div",{className:"App"},n.a.createElement(p,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(n.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},78:function(e,t,a){e.exports=a(198)},83:function(e,t,a){},84:function(e,t,a){}},[[78,1,2]]]);
//# sourceMappingURL=main.d3d89b18.chunk.js.map